<menu>
    <menuOption name="Items" icon="item">
	<script id="MainMenuItems">
            <![CDATA[
            declare $choice = menu(array("Use Item","Drop Item"));
            declare $drop = ($choice == 1);
	    declare $item = selectItem(false,$drop);
            
            if(is_valid($item))
            {
                if($drop)
                {
                    disposeItem($item,1);
                    message("Dropped {getItemName($item)}");
                }
                else
                {
                    declare @targets;
                    switch(getItemTargetable($item))
                    {
                        case $_ITEM_TRG_ALL:
                        case $_ITEM_TRG_GROUP:
                            @targets = menu::selectTargets(true);
                        break;
                        case $_ITEM_TRG_SELF_ONLY:
                        case $_ITEM_TRG_SINGLE:
                            @targets = menu::selectTargets(false);
                        break;
                        case $_ITEM_TRG_NONE:
                        default:
                        break;
                    }
                    if(len(@targets) == 0) return; // they hit back
                    useItem($item,@targets);
                }
                
	    }
                ]]>
	</script>
    </menuOption>
    <menuOption name="Skills" icon="skills">
	<script id="MainMenuSkills">
            <![CDATA[
            declare $choice = menu(array("Learn","Use"));
            if($choice == 0){
                declare @targets  = menu::selectTargets(false);
                if(len(@targets) ==0) return; // they hit back
                skilltree(@targets[0],true);
            }else{
                declare @targets = menu::selectTargets(false);
                if(len(@targets)==0) return;
                declare $skill = skilltree(@targets[0],false);
                if(is_valid($skill)){
                    doSkill($skill,@targets[0]);
                }
            }
                ]]>
	</script>
    </menuOption>
    <menuOption name="Equip" icon="equip">
	<script id="MainMenuEquip">
            declare @targets = menu::selectTargets(false);
            if(len(@targets) > 0)
                equipScreen(@targets[0]);
	</script>
    </menuOption>
    
    <menuOption name="Party" icon="party">
	<script id="MainMenuParty">
	</script>
        <menuOption name="Omegas" icon="omegas">
            <script id="MainMenuOmegas">
                <![CDATA[
                declare $slots = omegaSlotCount();                
                declare $mode = menu(array("Equip","Unequip"));
                if($mode == 0){
                    declare $item = selectItemAdv($_ITEM_OMEGA);
                    if(is_valid($item)){
                        declare @array;
                        var $s = 0;
                        for($s=0;$s<$slots;$s++){
                            if(omegaSlotIsEmpty($s)){
                                pushb @array, "Empty Slot";
                            }else{
                                pushb @aray, getItemName(getOmega($s));
                            }
                        }
                        declare $slot = 0;
                        if(len(@array) > 1){
                            $slot = menu(@array);
                        }else{
                            $slot = @array[0];
                        }
                                
                        equipOmega($slot,$item);
                        
                    }
                }else if($mode == 1){
                    if($slots > 1){
                        declare @array;
                        declare @slot_array;
                        var $s=0;
                        for($s=0;$s<$slots;$s++){
                            if(!omegaSlotIsEmpty($s)){
                                pushb @array, getItemName(getOmega($s));
                                pushb @slot_array,$s;
                            }
                        }
                        if(len(@array) > 1){
                            declare $selection = menu(@array);
                            unequipOmega(@slot_array[$selection]);
                        }else if(len(@array) == 1){
                            unequipOmega(@slot_array[0]);
                        }
                    }else{
                        if(!omegaSlotIsEmpty(0)){
                            unequipOmega(0);
                        }
                    }
                }
                    ]]>
            </script>
        </menuOption>
    </menuOption>
    <menuOption name="Config" icon="config">
	<script id="MainMenuConfig">
            
	</script>
        <menuOption name="Theme" icon="theme">
            <script id="MainMenuConfigTheme">
                // getThemes() is broken
            declare @themes = array("RPG Blue","Light Blue","Thunder","Fire", "Eighties");
            declare $theme = menu(@themes);
            setTheme(@themes[$theme]);
            menu::reload();
            </script>
        </menuOption>
    </menuOption>
    <menuOption name="Status" icon="status">
	<script id="MainMenuStatus">
            statusScreen();
	</script>
    </menuOption>  
</menu>