<!--DOCTYPE skillList SYSTEM "Levels/level.dtd" -->
<skillList>
    <skill bp="0" name="Info" sp="0">
        <onInvoke>
            <script id="InfoSkillScript">
                <![CDATA[
                var @targets = battle::selectTargets(true,false,true);
                var $pTarget = @targets[0];
                println("Target: " + getCharacterName($pTarget));
                println("HP: " + getCharacterAttribute($pTarget,$_HP) + " / " + getCharacterAttribute($pTarget,$_MAXHP));
                println("MP: " + getCharacterAttribute($pTarget,$_MP) + " / " + getCharacterAttribute($pTarget,$_MAXMP));

                if(getCharacterToggle($pTarget,$_ALIVE))
                    println("Alive");
                else println("Dead");

                battle::finishTurn();
                ]]>
            </script>
        </onInvoke>
    </skill>
    <skill bp="0" name="Attack" sp="0" icon="attack">
        <onInvoke>
            <script id="AttackSkillScript">
	    <![CDATA[
        var $pC = $Character;
		var $name = getCharacterName($pC);
        // The animation comes first.
        var @targets = battle::selectTargets(true,false,true);
        battle::doCharacterAnimation($pC,"attack");

        var $pWeapon = getEquipment($pC, $_HAND);
        const $kScriptMode = getWeaponScriptMode($pWeapon);
        if( $kScriptMode == $_SM_FORGO_ATTACK || getWeaponS)
            return;
        if( $kScriptMode == $_SM_ATTACK_AFTER){
            invokeEquipment($pWeapon);
        }

		var $pTarget = @targets[0];
		//var $pTargetArmor = getEquipment($pTarget

		println($name + " attacks " + getCharacterName($pTarget) + " with " + getItemName($pWeapon));

		var $hit = getCharacterAttribute($pC, $_DEX) + getEquippedWeaponAttribute($pC,$_HIT);
		var $dodge = getCharacterAttribute($pTarget, $_EVD) + getEquippedArmorAttribute($pTarget,$_AC);

		var $chance = $hit * ( 1.0 - $dodge );

		var $roll = math::randf();

		println("Hit was " + $hit + " and dodge was " + $dodge + " and chance was " + $chance);
		println("Roll was " + $roll);

		var $bHit = false;
		if($roll < $chance)
			$bHit = true;

        if($bHit){
            println("You hit!");
            playSound(getHitSound(getWeaponType($pWeapon)));
            battle::doCharacterAnimation($pTarget,"recoil");
            var $damageMean = getCharacterAttribute($pC, $_STR) + getEquippedWeaponAttribute($pC,$_ATTACK);
            // Random about the damageMean, standard deviation is 15% of the mean, so 68% of attacks fall within 10% deviation of the mean
            var $baseDamage = normal_random($damageMean,$damageMean * 0.15);
            var $actualDamage = $baseDamage *  getWeaponDamageCategoryResistance($pTarget,getWeaponTypeDamageCategory(getWeaponType($pWeapon)));
            battle::createDisplay($actualDamage,$pTarget,$_DISP_DAMAGE);
            doDamage($pTarget,integer($actualDamage));
            println("Mean damage was " + $damageMean + " and base damage was " + $baseDamage + " and actual damage was " + $actualDamage);
        }else{
            println("You missed.");
            playSound(getMissSound(getWeaponType($pWeapon)));
        }



                // If hit
                // Calculate damage
                // doAttack()
                // hit sound
                // recoil animation
                // else
                // pushDisplay("Miss");
                // playSound("whiff");

        if($kScriptMode == $_SM_ATTACK_BEFORE){
            invokeEquipment($pWeapon);
        }
        attackCharacter($pTarget);
        battle::finishTurn();
		]]>
            </script>
        </onInvoke>
    </skill>
    <skill bp="0" name="Item" sp="0" icon="item">
        <onInvoke>
            <script id="ItemSkillInvoke">
                //var $item = itemMenu();
                // selectTarget( single , group, default monsters )
                var @targets = battle::selectTargets(true,false,false);
                //var $queue = $_ActionQueue;
                //enqueueAction($queue, $_ActionScript, $_Actor, $target, false, $item);
                var $target = @targets[0];
                //var $item =  chooseItem();
                //useItem($_Group, $item, $target);

                battle::finishTurn();

            </script>
        </onInvoke>

    </skill>
	<skill bp="0" name="Focus" sp="5">
		<onInvoke>
			<script id="Focus">
				doStatusEffect("Focused",1);
			</script>
		</onInvoke>
	</skill>
	<skill bp="1.0" name="Wind Slash" sp="50"	>
		<onSelect>
			<script id="Wind Slash">
                // groupSelection ( default to enemy group? )
                // allows you to select a single target or a group
                // if you
                if(groupSelection(false))
                {
                   var $group = selectGroup();
                   enqueueGroupAction($_ActionScript,$_Actor,$group,0);
                }
                else
                {
                   var $target = selectTarget(true,true,true);
                   enqueueAction($_ActionScript,$Actor,$target,0);
                }
                                animation("WindSlash");
                doMagicDamage(100,1.0,"wind");
            </script>
		</onSelect>

	</skill>
	<skill bp="0" name="Thrift" sp="60" type="switch">
		<onInvoke>
			<script id="onThrift">
				modifyCommonAttribute("priceMultiplier", getCommonAttribute("priceMultiplier") * 0.9);
			</script>
		</onInvoke>
		<onRemove>
			<script id="rmThrift">
				modifyCommonAttribute("priceMultiplier",getCommonAttribute("priceMultiplier") * 10/9);
			</script>
		</onRemove>
	</skill>
	<skill bp="0" name="Caution" sp="60" type="switch">
		<onInvoke>
			<script id="onCaution">
			modifyCommonAttribute("encounterRate",getCommonAttribute("encounterRate") * 0.75);
			</script>
		</onInvoke>
		<onRemove>
			<script id="rmCaution">
			modifyCommonAttribute("encounterRate",getCommonAttribute("encounterRate") * 10/7.5);
			</script>
		</onRemove>
	</skill>
	<!--
	<spell mp="2" name="Torch" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="2200">
		<magicResistance type="fire" resist="0.25"/>
		<doMagicDamage baseDamage="25" baseHit="75">
			<magicDamageCategory type="fire"/>
		</doMagicDamage>
	</spell>
	<spell mp="2" name="Stonepelt" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="2200">
		<magicResistance type="earth" resist="0.25"/>
		<doMagicDamage baseDamage="25" baseHit="75">
			<magicDamageCategory type="earth"/>
		</doMagicDamage>
	</spell>
	<spell mp="2" name="Ice" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="2200">
		<magicResistance type="water" resist="0.25"/>
		<doMagicDamage baseDamage="25" baseHit="75">
			<magicDamageCategory type="water"/>
		</doMagicDamage>
	</spell>
	<spell mp="2" name="Wind" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="2200">
		<magicResistance type="wind" resist="0.25"/>
		<doMagicDamage baseDamage="25" baseHit="75">
			<magicDamageCategory type="wind"/>
		</doMagicDamage>
	</spell>
	<spell mp="2" name="Anoint" targetable="either" type="white" use="both" appliesToArmor="true" appliesToWeapons="true" value="2200">
		<magicResistance type="holy" resist="0.25"/>
		<doMagicDamage baseDamage="25" baseHit="75">
			<magicDamageCategory type="holy"/>
		</doMagicDamage>
	</spell>
	<spell mp="8" name="Flame" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="7000">
		<magicResistance type="fire" resist="0.40"/>
		<doMagicDamage baseDamage="100" baseHit="75">
			<magicDamageCategory type="fire"/>
		</doMagicDamage>
	</spell>
	<spell mp="8" name="Crush" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="7000">
		<magicResistance type="earth" resist="0.40"/>
		<doMagicDamage baseDamage="100" baseHit="75">
			<magicDamageCategory type="earth"/>
		</doMagicDamage>
	</spell>
	<spell mp="8" name="Frost" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="7000">
		<magicResistance type="water" resist="0.40"/>
		<doMagicDamage baseDamage="100" baseHit="75">
			<magicDamageCategory type="water"/>
		</doMagicDamage>
	</spell>
	<spell mp="8" name="Storm" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="7000">
		<magicResistance type="wind" resist="0.40"/>
		<doMagicDamage baseDamage="100" baseHit="75">
			<magicDamageCategory type="wind"/>
		</doMagicDamage>
	</spell>
	<spell mp="8" name="Holy Anoint" targetable="either" type="white" use="both" appliesToArmor="true" appliesToWeapons="true" value="7000">
		<magicResistance type="holy" resist="0.40"/>
		<doMagicDamage baseDamage="100" baseHit="75">
			<magicDamageCategory type="holy"/>
		</doMagicDamage>
	</spell>
	<spell mp="20" name="Blaze" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="12000">
		<magicResistance type="fire" resist="0.50"/>
		<doMagicDamage baseDamage="250" baseHit="80">
			<magicDamageCategory type="fire"/>
		</doMagicDamage>
	</spell>
	<spell mp="20" name="Avalanche" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="12000">
		<magicResistance type="earth" resist="0.50"/>
		<doMagicDamage baseDamage="250" baseHit="80">
			<magicDamageCategory type="earth"/>
		</doMagicDamage>
	</spell>
	<spell mp="20" name="Blizzard" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="12000">
		<magicResistance type="water" resist="0.50"/>
		<doMagicDamage baseDamage="250" baseHit="80">
			<magicDamageCategory type="water"/>
		</doMagicDamage>
	</spell>
	<spell mp="20" name="Hurricane" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="12000">
		<magicResistance type="wind" resist="0.50"/>
		<doMagicDamage baseDamage="250" baseHit="80">
			<magicDamageCategory type="wind"/>
		</doMagicDamage>
	</spell>
	<spell mp="20" name="Blessed Anoint" targetable="either" type="white" use="both" appliesToArmor="true" appliesToWeapons="true" value="12000">
		<magicResistance type="holy" resist="0.50"/>
		<doMagicDamage baseDamage="250" baseHit="80">
			<magicDamageCategory type="holy"/>
		</doMagicDamage>
	</spell>
	<spell mp="50" name="Firestorm" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="25000">
		<magicResistance type="fire" resist="0.75"/>
		<doMagicDamage baseDamage="600" baseHit="90">
			<magicDamageCategory type="fire"/>
		</doMagicDamage>
	</spell>
	<spell mp="50" name="Meteor" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="25000">
		<magicResistance type="earth" resist="0.75"/>
		<doMagicDamage baseDamage="600" baseHit="90">
			<magicDamageCategory type="earth"/>
		</doMagicDamage>
	</spell>
	<spell mp="50" name="Absolute Zero" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="25000">
		<magicResistance type="water" resist="0.75"/>
		<doMagicDamage baseDamage="600" baseHit="90">
			<magicDamageCategory type="water"/>
		</doMagicDamage>
	</spell>
	<spell mp="50" name="Zephyr" targetable="either" type="elemental" use="battle" appliesToArmor="true" appliesToWeapons="true" value="25000">
		<magicResistance type="wind" resist="0.75"/>
		<doMagicDamage baseDamage="600" baseHit="90">
			<magicDamageCategory type="wind"/>
		</doMagicDamage>
	</spell>
	<spell mp="50" name="Blessed Anoint" targetable="either" type="white" use="both" appliesToArmor="true" appliesToWeapons="true" value="25000">
		<magicResistance type="holy" resist="0.75"/>
		<doMagicDamage baseDamage="600" baseHit="90">
			<magicDamageCategory type="holy"/>
		</doMagicDamage>
	</spell> -->

</skillList>
