<setup>
    <![CDATA[
    println("Setup");
	]]>
</setup>
<onWon>
    <![CDATA[
	require("Media/Scripts/functions.steel");
	println("A winner is you");
	declare @monsters = battle::getCharacterGroup(true); // Get monsters
	declare @characters = battle::getCharacterGroup(false); // Get characters
	declare @xp_gain;
	declare @original_level;
	const $B = 10; // How many equal-level monsters to defeat to gain a level
	const $b = 1.12; // At 1.07, a character 10 levels higher than you is worth double the XP
	foreach (declare $character) in @characters {
	    declare $total_xp = 0;
	    foreach (declare $monster) in @monsters {
		declare $char_level = getCharacterLevel($character);
		declare $monster_level = getCharacterLevel($monster);
	
		declare $xp = ((tnl($char_level + 1) - tnl($char_level)) /  $B) * ($b ^ ($monster_level - $char_level));
		$total_xp = $total_xp + $xp;
	    }
	    $total_xp = math::ceil($total_xp);
	    
	    println ( "{getCharacterName($character)} got {$total_xp}" );
	    @xp_gain += $total_xp;
	    @original_level += getCharacterLevel($character); 
	    addExperience($character,$total_xp);
	}
	battle::darkColor(0.0,0.0,0.0,0.9);
	battle::darkMode($_FINAL_DRAW);
	showExperience(@characters,@xp_gain,@original_level);
	declare $winnings = 0;
	const $winningsPerLevel = 5;
	const $winningsGrowth = 1.15;
	foreach (declare $monster) in @monsters {
	    $winnings += $winningsPerLevel * ($b ^ getCharacterLevel($monster));
	}
	giveGold($winnings);
	]]>
</onWon>
<onLost>
    <![CDATA[
    println("Lost");
	]]>
</onLost>